---
title: "flex_template"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
```
Page 1
=====================================  
Column {data-width=350}
-----------------------------------------------------------------------


### Chart A

```{r}
library(plotly)
library(dplyr)
library(sf)
library(elevatr)
library(forcats)


# Read in the National Park centroid data
np_centroid <- read_sf("Raw_Data/NPS_Centroid/")

# Extract longitude and latitude from geometry
np_centroid <- np_centroid %>%
  mutate(
    lon = st_coordinates(geometry)[, 1],  # Longitude
    lat = st_coordinates(geometry)[, 2]  # Latitude
  )

# Get elevation data
elevation_data <- get_elev_point(np_centroid, prj = st_crs(np_centroid), src = "aws") %>%
  arrange(elevation)

# Reorder PARKNAME by elevation
elevation_data <- elevation_data %>%
  filter(UNIT_TYPE == "National Park") %>%
  mutate(PARKNAME = fct_reorder(PARKNAME, elevation))

# Selecting Great Smoky Mountains for highlighting
gsm <- elevation_data %>% 
  filter(PARKNAME == "Great Smoky Mountains")

# Interactive plot using Plotly
plot <- plot_ly(
  data = elevation_data,
  x = ~PARKNAME,
  y = ~elevation,
  type = 'scatter',
  mode = 'markers',
  text = ~paste0(
    "<b>Park Name:</b> ", PARKNAME, "<br>",
    "<b>Elevation:</b> ", elevation, " meters<br>",
    "<b>Latitude:</b> ", round(lat, 2), "<br>",
    "<b>Longitude:</b> ", round(lon, 2)
  ),
  hoverinfo = "text",
  marker = list(size = 10, color = "blue")
) %>%
  layout(
    title = "Elevation of U.S. National Parks (Ordered by Elevation)",
    xaxis = list(title = "U.S. National Park Name", tickangle = 45),
    yaxis = list(title = "Elevation (meters)")
  )

# Add a special marker for the Great Smoky Mountains
plot <- plot %>%
  add_trace(
    data = gsm,
    x = ~PARKNAME,
    y = ~elevation,
    type = 'scatter',
    mode = 'markers+text',
    text = ~paste("Great Smoky Mountains: ", elevation, "m"),
    textposition = "top center",
    marker = list(size = 12, color = "red"),
    hoverinfo = "text"
  )

# Display the plot
plot


```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r, fig.width=10, fig.height=5}
library(readr)


# Read in cleaned data
nps_species <- read_csv("smoky_mountains.csv")

# Exclude vascular plants
nps_species <- nps_species %>%
  filter(TaxaGroup != "Vascular-plant") %>%
  filter(TaxaGroup != "Non-vascular plant") %>%
  filter(!grepl("Wide", ElevationRange))

# Categories
#nps_species %>%
  #count(ElevationRange)

# Expand data for overlapping ranges
expanded_data <- nps_species %>%
  mutate(Elevation_Group = case_when(
    ElevationRange == "Low" ~ "Low",
    ElevationRange == "Mid" ~ "Mid",
    ElevationRange == "High" ~ "High",
    ElevationRange == "Low and High" ~ "Low", # First group for Low and High
    ElevationRange == "Low to High" ~ "Low",  # First group for Low to High
    ElevationRange == "Low to Mid" ~ "Low",   # First group for Low to Mid
    ElevationRange == "Mid to High" ~ "Mid"   # First group for Mid to High
  )) %>%
  bind_rows(
    nps_species %>%
      filter(ElevationRange == "Low and High") %>%
      mutate(Elevation_Group = "High")
  ) %>%
  bind_rows(
    nps_species %>%
      filter(ElevationRange == "Low to High") %>%
      mutate(Elevation_Group = "Mid")
  ) %>%
  bind_rows(
    nps_species %>%
      filter(ElevationRange == "Low to High") %>%
      mutate(Elevation_Group = "High")
  ) %>%
  bind_rows(
    nps_species %>%
      filter(ElevationRange == "Low to Mid") %>%
      mutate(Elevation_Group = "Mid")
  ) %>%
  bind_rows(
    nps_species %>%
      filter(ElevationRange == "Mid to High") %>%
      mutate(Elevation_Group = "High")
  )

# Summarize counts for each group
result <- expanded_data %>%
  group_by(Elevation_Group) %>%
  count(ElevationRange)


# Elevation groups for plotting
Low <- expanded_data %>%
  filter(Elevation_Group == "Low") %>%
  group_by(CategoryName)

Mid <- expanded_data %>%
  filter(Elevation_Group == "Mid") %>%
  group_by(CategoryName) 

High <- expanded_data %>%
  filter(Elevation_Group == "High") %>%
  group_by(CategoryName)

# Combined Plot -------
expanded_data %>%
  ggplot(aes(x = CategoryName, fill = Nativeness)) +
  geom_bar() +
  facet_grid(~ factor(Elevation_Group, levels = c("Low", "Mid", "High"))) +
  ggtitle("Nativeness of Species in the Great Smoky Mountains", 
          subtitle = "By Elevation Range") +
  labs(y="Count", x= "Species Category")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size=10),
        axis.text.y = element_text(size=16),
        axis.title=element_text(size=16,face="bold"),
        plot.title = element_text(size = 20, face = "bold"),
        plot.subtitle = element_text(size=15, face= "bold"),
        strip.text.x = element_text(size = 12, face = "bold"), 
        legend.title=element_text(size=14, face = "bold"), 
        legend.text=element_text(size=10))
```


### Chart C

```{r}

```
ReadMe {data-orientation=rows}
=====================================     
   
Row {data-height=600}
-------------------------------------

### header
this setup allows for two pages, page 1 for graphs and page 2 for readme info, chart A is on top and B and C are split evenly on the bottom panel and will be the interactive graph 

info here
link to github?
where we got data from
all the info about the graphs
maybe csu logo would be cool

### Picture (not final)


```{r dpi=10}
#knitr::include_graphics("images/Yosemitepic.jpg")
```
</center></a>

